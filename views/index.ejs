<%-include layout/header.ejs %>


    <form class="form-center">
        <div class="container">
            <div class="row">

                <div class="col-lg-8">
                    <div class="row">
                        <input class="form-control" type="search" placeholder="Поиск" aria-label="search" id="input_search" name="param">
                    </div>
                </div>


                <div class="col-lg-4">
                    <div class="row">

                        <div class="input-group">
                            <select class="custom-select" id="inputGroupSelect04" name="filter">
                                <option selected>Фильтры</option>
                                <option value="author">Автор</option>
                                <option value="subject">Предмет</option>
                                <option value="rate">Класс</option>
                                <option value="theme">Тема</option>
                            </select>
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="submit" id="search">Поиск</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <br>
    <div class="table-responsive">
        <table class="table table-striped table-hover" id="maintable">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">Название</th>
                    <th scope="col">Автор</th>
                    <th scope="col">Предмет</th>
                    <th scope="col">Класс</th>
                    <th scope="col">Тема</th>
                    <th scope="col">Дата</th>
                </tr>
            </thead>
            <tbody id="table_body">
                <% tests.forEach(function(test){ %>
                    <tr onclick="window.location='/test_view?test_id=<%= test.id%>'">
                        <th scope="row">
                            <%= test.name %>
                        </th>
                        <td>
                            <%= test.author %>
                        </td>
                        <td>
                            <%= test.subject %>
                        </td>
                        <td>
                            <%= test.rate %>
                        </td>
                        <td>
                            <%= test.theme %>
                        </td>
                        <td>
                            <%= new Date(test.date).getDate() +'.0'+ +(new Date(test.date).getMonth() + 1) +'.'+ new Date(test.date).getFullYear() %>
                        </td>
                        </a>
                    </tr>

                    <% }); %>
            </tbody>

        </table>
    </div>
    <script>
        $('.form-center').submit(function (event) {
            //проверка на заполненность строки поиска
            var data = $('.form-center').serialize();
            $.get(`/`,{param: data.param, filter: data.filter},function (arr) {
                    $('#table_body').empty();
                    for (var i = 0; i < arr.length; i++) {
                        $('#table_body').append(
                            `<tr onclick="window.location='/test_view?test_id=${arr[i].id}'">
                                                <th scope="row">${arr[i].name}</th>
                                                <td>${arr[i].author}</td>
                                                <td>${arr[i].subject}</td>
                                                <td>${arr[i].rate}</td>
                                                <td>${arr[i].theme}</td>
                                                <td>new Date(${arr[i].date}).getDate() +'.0'+ +(new Date(${arr[i].date}).getMonth() + 1) +'.'+ new Date(${arr[i].date}).getFullYear()</td>
                                            </a>
                                        </tr>  `
                        )
                    }
                }, "json");
           /* $.ajax({
                url: `/`,
                method: 'GET',
                data: function () {
                    var obj = $('.form-center').serialize();
                    return 'param=' + obj.param + '&filter=' + obj.filter;
                },
            })*/
        });
        /*function (arr) {
                    $('#table_body').empty();
                    for (var i = 0; i < arr.length; i++) {
                        $('#table_body').append(
                            `<tr onclick="window.location='/test_view?test_id=${arr[i].id}'">
                                                <th scope="row">${arr[i].name}</th>
                                                <td>${arr[i].author}</td>
                                                <td>${arr[i].subject}</td>
                                                <td>${arr[i].rate}</td>
                                                <td>${arr[i].theme}</td>
                                                <td>new Date(${arr[i].date}).getDate() +'.0'+ +(new Date(${arr[i].date}).getMonth() + 1) +'.'+ new Date(${arr[i].date}).getFullYear()</td>
                                            </a>
                                        </tr>  `
                        )
                    }
                }*/
    </script>


    <%- include layout/footer.ejs %>